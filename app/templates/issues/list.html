{% extends "base.html" %}
{% block content %}
  <h1>Issues for {{ project.name }}</h1>

  <p>
    <a href="{{ url_for('main.issue_create', project_id=project.id) }}">+ New Issue</a> |
    <a href="{{ url_for('main.projects_list') }}">Back to projects</a>
  </p>

  <form method="GET" action="{{ url_for('main.project_issues', project_id=project.id) }}">
    <input type="text" name="q" placeholder="Search title..." value="{{ current_filters.q or '' }}">
    <select name="status">
      <option value="">-- Any status --</option>
      {% for s in statuses %}
        <option value="{{ s }}" {% if current_filters.status == s %}selected{% endif %}>{{ s }}</option>
      {% endfor %}
    </select>

    <select name="priority">
      <option value="">-- Any priority --</option>
      {% for p in priorities %}
        <option value="{{ p }}" {% if current_filters.priority == p %}selected{% endif %}>{{ p }}</option>
      {% endfor %}
    </select>

    <select name="assignee">
      <option value="">-- Any assignee --</option>
      <option value="unassigned" {% if current_filters.assignee == 'unassigned' %}selected{% endif %}>Unassigned</option>
      {% for u in users %}
        <option value="{{ u.id }}" {% if current_filters.assignee and current_filters.assignee|int == u.id %}selected{% endif %}>{{ u.username }}</option>
      {% endfor %}
    </select>

    <button type="submit">Filter</button>
    <a href="{{ url_for('main.project_issues', project_id=project.id) }}">Clear</a>
  </form>

  <hr>

  {% if issues %}
    <ul>
      {% for issue in issues %}
        <li>
          <a href="{{ url_for('main.issue_detail', issue_id=issue.id) }}">
            <strong>{{ issue.title }}</strong>
          </a>
          — {{ issue.status }} | {{ issue.priority }}
          <br>
          Reporter: {{ issue.reporter.username }} |
          Assignee: {{ issue.assignee.username if issue.assignee else "Unassigned" }} |
          Created: {{ issue.created_at }}
        </li>
      {% endfor %}
    </ul>

    <div>
      {% if pagination.has_prev %}
        <a href="{{ url_for('main.project_issues', project_id=project.id, page=pagination.prev_num, **current_filters) }}">← Prev</a>
      {% endif %}
      Page {{ pagination.page }} of {{ pagination.pages }}
      {% if pagination.has_next %}
        <a href="{{ url_for('main.project_issues', project_id=project.id, page=pagination.next_num, **current_filters) }}">Next →</a>
      {% endif %}
    </div>

  {% else %}
    <p>No issues found.</p>
  {% endif %}
{% endblock %}
